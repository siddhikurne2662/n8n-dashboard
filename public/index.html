<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Workflow Manager - Simple & Powerful</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --primary: #6366f1;
    --primary-dark: #4f46e5;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --info: #3b82f6;
    --bg-light: #f8fafc;
    --bg-white: #ffffff;
    --text-dark: #1e293b;
    --text-gray: #64748b;
    --border: #e2e8f0;
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
    --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
    --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
    --radius: 12px;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: var(--bg-light);
    color: var(--text-dark);
    line-height: 1.6;
  }

  /* Header */
  .header {
    background: var(--bg-white);
    box-shadow: var(--shadow-sm);
    position: sticky;
    top: 0;
    z-index: 100;
    border-bottom: 1px solid var(--border);
  }

  .header-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 2rem;
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary);
  }

  .logo i {
    font-size: 2rem;
    background: linear-gradient(135deg, var(--primary), var(--info));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .search-bar {
    flex: 1;
    max-width: 500px;
    position: relative;
  }

  .search-bar input {
    width: 100%;
    padding: 0.75rem 1rem 0.75rem 2.75rem;
    border: 2px solid var(--border);
    border-radius: var(--radius);
    font-size: 0.95rem;
    transition: var(--transition);
    background: var(--bg-light);
  }

  .search-bar input:focus {
    outline: none;
    border-color: var(--primary);
    background: var(--bg-white);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
  }

  .search-bar i {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-gray);
  }

  .header-actions {
    display: flex;
    gap: 1rem;
    align-items: center;
  }

  .btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: var(--radius);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.95rem;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    box-shadow: var(--shadow-md);
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .btn-icon {
    width: 40px;
    height: 40px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-light);
    color: var(--text-dark);
  }

  .btn-icon:hover {
    background: var(--border);
  }

  /* Main Content */
  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem 1.5rem;
  }

  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .page-title {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-dark);
  }

  .stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .stat-card {
    background: var(--bg-white);
    padding: 1.5rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border);
    transition: var(--transition);
  }

  .stat-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
  }

  .stat-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    margin-bottom: 0.75rem;
  }

  .stat-icon.primary { background: rgba(99, 102, 241, 0.1); color: var(--primary); }
  .stat-icon.success { background: rgba(16, 185, 129, 0.1); color: var(--success); }
  .stat-icon.warning { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
  .stat-icon.info { background: rgba(59, 130, 246, 0.1); color: var(--info); }

  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 0.25rem;
  }

  .stat-label {
    color: var(--text-gray);
    font-size: 0.9rem;
  }

  /* Workflow Grid */
  .workflows-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 1.5rem;
  }

  .workflow-card {
    background: var(--bg-white);
    border-radius: var(--radius);
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border);
    overflow: hidden;
    transition: var(--transition);
  }

  .workflow-card:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-4px);
    border-color: var(--primary);
  }

  .workflow-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
  }

  .workflow-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
  }

  .workflow-id {
    font-size: 0.85rem;
    color: var(--text-gray);
    font-family: 'Courier New', monospace;
  }

  .status-badge {
    padding: 0.4rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    white-space: nowrap;
  }

  .status-badge.active {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success);
  }

  .status-badge.inactive {
    background: rgba(100, 116, 139, 0.1);
    color: var(--text-gray);
  }

  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: currentColor;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .workflow-body {
    padding: 1.5rem;
  }

  .workflow-meta {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-bottom: 1rem;
  }

  .meta-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.9rem;
    color: var(--text-gray);
  }

  .meta-item i {
    width: 20px;
    text-align: center;
    color: var(--primary);
  }

  .workflow-actions {
    display: flex;
    gap: 0.5rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border);
  }

  .action-btn {
    flex: 1;
    padding: 0.75rem;
    border: 1px solid var(--border);
    background: var(--bg-light);
    border-radius: 8px;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-dark);
  }

  .action-btn:hover {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
    transform: translateY(-2px);
  }

  .action-btn.run { color: var(--success); }
  .action-btn.run:hover { background: var(--success); color: white; }

  .action-btn.stop { color: var(--danger); }
  .action-btn.stop:hover { background: var(--danger); color: white; }

  .action-btn.info { color: var(--info); }
  .action-btn.info:hover { background: var(--info); color: white; }

  /* Modal */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 1rem;
  }

  .modal.active {
    display: flex;
  }

  .modal-content {
    background: var(--bg-white);
    border-radius: var(--radius);
    box-shadow: var(--shadow-lg);
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .modal-title {
    font-size: 1.5rem;
    font-weight: 700;
  }

  .modal-close {
    width: 36px;
    height: 36px;
    border: none;
    background: var(--bg-light);
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
  }

  .modal-close:hover {
    background: var(--danger);
    color: white;
  }

  .modal-body {
    padding: 1.5rem;
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: var(--text-dark);
  }

  .form-input,
  .form-select {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid var(--border);
    border-radius: var(--radius);
    font-size: 0.95rem;
    transition: var(--transition);
    background: var(--bg-light);
  }

  .form-input:focus,
  .form-select:focus {
    outline: none;
    border-color: var(--primary);
    background: var(--bg-white);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--text-gray);
  }

  .empty-state i {
    font-size: 4rem;
    color: var(--border);
    margin-bottom: 1rem;
  }

  /* Loading */
  .loading {
    display: flex;
    justify-content: center;
    padding: 3rem;
  }

  .spinner {
    width: 40px;
    height: 40px;
    border: 4px solid var(--border);
    border-top-color: var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* Responsive */
  @media (max-width: 768px) {
    .header-content {
      flex-wrap: wrap;
    }

    .search-bar {
      order: 3;
      max-width: 100%;
    }

    .workflows-grid {
      grid-template-columns: 1fr;
    }

    .stats-row {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>

<header class="header">
  <div class="header-content">
    <div class="logo">
      <i class="fas fa-project-diagram"></i>
      <span>Workflow Hub</span>
    </div>

    <div class="search-bar">
      <i class="fas fa-search"></i>
      <input type="search" id="searchInput" placeholder="Search workflows...">
    </div>

    <div class="header-actions">
      <button class="btn btn-icon" title="Settings" onclick="openSettings()">
        <i class="fas fa-cog"></i>
      </button>
    </div>
  </div>
</header>

<main class="container">
  <div class="page-header">
    <h1 class="page-title">Your Workflows</h1>
  </div>

  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-icon primary">
        <i class="fas fa-layer-group"></i>
      </div>
      <div class="stat-value" id="totalWorkflows">0</div>
      <div class="stat-label">Total Workflows</div>
    </div>

    <div class="stat-card">
      <div class="stat-icon success">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="stat-value" id="activeWorkflows">0</div>
      <div class="stat-label">Active Workflows</div>
    </div>

    <div class="stat-card">
      <div class="stat-icon warning">
        <i class="fas fa-pause-circle"></i>
      </div>
      <div class="stat-value" id="inactiveWorkflows">0</div>
      <div class="stat-label">Inactive Workflows</div>
    </div>

    <div class="stat-card">
      <div class="stat-icon info">
        <i class="fas fa-bolt"></i>
      </div>
      <div class="stat-value" id="recentRuns">0</div>
      <div class="stat-label">Recent Executions</div>
    </div>
  </div>

  <div class="workflows-grid" id="workflowsGrid">
    <div class="loading">
      <div class="spinner"></div>
    </div>
  </div>
</main>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title" id="modalTitle">Modal</h2>
      <button class="modal-close" onclick="closeModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<script>
const API_BASE = 'http://localhost:4000/api/workflows';
let workflows = [];

// Fetch workflows
async function loadWorkflows() {
  const grid = document.getElementById('workflowsGrid');

  try {
    const res = await fetch(API_BASE);

    if (!res.ok) {
      const errorText = await res.text();
      throw new Error(`Server returned ${res.status}: ${errorText}`);
    }

    const data = await res.json();
    workflows = data.data || [];

    updateStats();
    renderWorkflows();
  } catch (err) {
    console.error('Load error:', err);
    grid.innerHTML = `
      <div class="empty-state">
        <i class="fas fa-exclamation-circle"></i>
        <h3>Failed to load workflows</h3>
        <p style="color: var(--danger); font-weight: 600;">${err.message}</p>
        <p style="margin-top: 1rem;">Check console for details</p>
        <button class="btn btn-primary" onclick="loadWorkflows()" style="margin-top: 1rem;">
          <i class="fas fa-sync"></i> Retry
        </button>
      </div>
    `;
  }
}

// Update statistics
function updateStats() {
  const active = workflows.filter(w => w.active).length;
  document.getElementById('totalWorkflows').textContent = workflows.length;
  document.getElementById('activeWorkflows').textContent = active;
  document.getElementById('inactiveWorkflows').textContent = workflows.length - active;
  document.getElementById('recentRuns').textContent = '‚Äî';
}

// Render workflows
function renderWorkflows() {
  const grid = document.getElementById('workflowsGrid');
  const query = document.getElementById('searchInput').value.toLowerCase();
  const filtered = workflows.filter(w =>
    (w.name || '').toLowerCase().includes(query)
  );

  if (!filtered.length) {
    grid.innerHTML = `
      <div class="empty-state">
        <i class="fas fa-folder-open"></i>
        <h3>No workflows found</h3>
        <p>Try adjusting your search or create a new workflow</p>
      </div>
    `;
    return;
  }

  grid.innerHTML = filtered.map(w => `
    <div class="workflow-card">
      <div class="workflow-header">
        <div>
          <h3 class="workflow-title">${w.name || 'Untitled Workflow'}</h3>
          <p class="workflow-id">ID: ${w.id}</p>
        </div>
        <span class="status-badge ${w.active ? 'active' : 'inactive'}">
          <span class="status-dot"></span>
          ${w.active ? 'Active' : 'Inactive'}
        </span>
      </div>

      <div class="workflow-body">
        <div class="workflow-meta">
          <div class="meta-item">
            <i class="fas fa-calendar-plus"></i>
            <span>Created ${formatDate(w.createdAt)}</span>
          </div>
          <div class="meta-item">
            <i class="fas fa-clock"></i>
            <span>Updated ${formatDate(w.updatedAt)}</span>
          </div>
        </div>

        <div class="workflow-actions">
          <button class="action-btn run" onclick="runWorkflow('${w.id}')" title="Run workflow">
            <i class="fas fa-play"></i>
            Run
          </button>
          <button class="action-btn ${w.active ? 'stop' : 'run'}"
                  onclick="toggleWorkflow('${w.id}', ${w.active})"
                  title="${w.active ? 'Deactivate' : 'Activate'} workflow">
            <i class="fas fa-power-off"></i>
            ${w.active ? 'Stop' : 'Start'}
          </button>
          <button class="action-btn info" onclick="viewDetails('${w.id}')" title="View details">
            <i class="fas fa-info-circle"></i>
            Info
          </button>
        </div>
      </div>
    </div>
  `).join('');
}

// Format date
function formatDate(dateStr) {
  if (!dateStr) return 'N/A';
  const date = new Date(dateStr);
  const now = new Date();
  const diff = now - date;
  const days = Math.floor(diff / (1000 * 60 * 60 * 24));

  if (days === 0) return 'Today';
  if (days === 1) return 'Yesterday';
  if (days < 7) return `${days} days ago`;
  return date.toLocaleDateString();
}

// Run workflow
async function runWorkflow(id) {
  try {
    await fetch(`${API_BASE}/${id}/run`, { method: 'POST' });
    showToast('‚úÖ Workflow started successfully!', 'success');
  } catch (err) {
    showToast('‚ùå Failed to start workflow', 'error');
  }
}

// Toggle workflow
async function toggleWorkflow(id, active) {
  try {
    await fetch(`${API_BASE}/${id}/toggle`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ active: !active })
    });
    showToast(`Workflow ${!active ? 'activated' : 'deactivated'}`, 'success');
    loadWorkflows();
  } catch (err) {
    showToast('‚ùå Failed to update workflow', 'error');
  }
}

// View details
function viewDetails(id) {
  const wf = workflows.find(w => w.id === id);
  showModal('Workflow Details', `
    <div class="workflow-meta">
      <div class="meta-item">
        <i class="fas fa-tag"></i>
        <strong>Name:</strong> ${wf.name || 'Untitled'}
      </div>
      <div class="meta-item">
        <i class="fas fa-fingerprint"></i>
        <strong>ID:</strong> ${wf.id}
      </div>
      <div class="meta-item">
        <i class="fas fa-toggle-on"></i>
        <strong>Status:</strong> ${wf.active ? 'üü¢ Active' : 'üî¥ Inactive'}
      </div>
      <div class="meta-item">
        <i class="fas fa-calendar"></i>
        <strong>Created:</strong> ${new Date(wf.createdAt).toLocaleString()}
      </div>
      <div class="meta-item">
        <i class="fas fa-sync"></i>
        <strong>Updated:</strong> ${new Date(wf.updatedAt).toLocaleString()}
      </div>
    </div>
    <div style="margin-top: 1.5rem;">
      <button class="btn btn-primary" onclick="closeModal()">Close</button>
    </div>
  `);
}

// New workflow
function openNewWorkflow() {
  showModal('Create New Workflow', `
    <form onsubmit="createWorkflow(event)">
      <div class="form-group">
        <label class="form-label">Workflow Name</label>
        <input type="text" class="form-input" id="wfName" placeholder="My Awesome Workflow" required>
      </div>
      <div class="form-group">
        <label class="form-label">Status</label>
        <select class="form-select" id="wfActive">
          <option value="false">Inactive (Recommended for new workflows)</option>
          <option value="true">Active</option>
        </select>
      </div>
      <div style="display: flex; gap: 1rem;">
        <button type="submit" class="btn btn-primary" style="flex: 1;">
          <i class="fas fa-check"></i> Create Workflow
        </button>
        <button type="button" class="btn btn-icon" onclick="closeModal()">Cancel</button>
      </div>
    </form>
  `);
}

// Create workflow
async function createWorkflow(e) {
  e.preventDefault();
  const name = document.getElementById('wfName').value;
  const active = document.getElementById('wfActive').value === 'true';

  try {
    await fetch(API_BASE, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, active, nodes: [], connections: {} })
    });
    showToast('‚úÖ Workflow created successfully!', 'success');
    closeModal();
    loadWorkflows();
  } catch (err) {
    showToast('‚ùå Failed to create workflow', 'error');
  }
}

// Settings
function openSettings() {
  showModal('Settings', `
    <div class="form-group">
      <label class="form-label">API Base URL</label>
      <input type="text" class="form-input" value="${API_BASE}" readonly>
    </div>
    <div class="form-group">
      <label class="form-label">Theme</label>
      <select class="form-select">
        <option>Light (Current)</option>
        <option>Dark (Coming Soon)</option>
      </select>
    </div>
    <button class="btn btn-primary" onclick="closeModal()">Close</button>
  `);
}

// Modal helpers
function showModal(title, content) {
  document.getElementById('modalTitle').textContent = title;
  document.getElementById('modalBody').innerHTML = content;
  document.getElementById('modal').classList.add('active');
}

function closeModal() {
  document.getElementById('modal').classList.remove('active');
}

// Toast notification
function showToast(message, type) {
  alert(message);
}

// Search
document.getElementById('searchInput').addEventListener('input', renderWorkflows);

// Close modal on outside click
document.getElementById('modal').addEventListener('click', (e) => {
  if (e.target.id === 'modal') closeModal();
});

// Initialize
loadWorkflows();
</script>

</body>
</html>